#!/bin/sh

PROJECT_DIR=$(cd `dirname $0` && pwd)/..
TMP_DIR="${PROJECT_DIR}/tmp"

if [ `which uname` ]; then
    case "`uname -a`" in
        CYGWIN*)
            CYGWIN=1 ;;
    esac
fi

[ -d "${TMP_DIR}" ] || mkdir -p "${TMP_DIR}"

PHPRC="${PROJECT_DIR}/etc/phpt.ini"
PHP_INCLUDE_PATH="${PROJECT_DIR}/lib"
PHP_AUTO_PREPEND_FILE="${PROJECT_DIR}/libexec/tap.php"
PHP_ERROR_LOG="${TMP_DIR}/test.log"

if [ -n "${CYGWIN}" ] ; then
    PHPRC="`cygpath -w -a -- "${PHPRC}"`"
    PHP_INCLUDE_PATH="`cygpath -w -a -- "${PHP_INCLUDE_PATH}"`"
    PHP_AUTO_PREPEND_FILE="`cygpath -w -a -- "${PHP_AUTO_PREPEND_FILE}"`"
    PHP_ERROR_LOG="`cygpath -w -a -- "${PHP_ERROR_LOG}"`"
fi

PHP_EXE="`which php-cli 2>/dev/null`"
if [ ! -x "${PHP_EXE}" ]; then
    PHP_EXE="`which php 2>/dev/null`"
fi
if [ ! -x "${PHP_EXE}" ]; then
    echo "Sorry but can't find php."; exit 1
fi

"${PHP_EXE}" -d include_path="${PHP_INCLUDE_PATH}" \
    -d auto_prepend_file="${PHP_AUTO_PREPEND_FILE}" \
    -d error_log="${PHP_ERROR_LOG}" \
    "$@"

# EOF
