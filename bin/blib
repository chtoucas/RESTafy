#!/bin/sh
# TODO: cleanup

PROJECT_DIR=$(cd `dirname $0` && pwd)/..
LIB_DIR="${PROJECT_DIR}/lib"
BLIB_DIR="${PROJECT_DIR}/_build/lib"

[ -d ${BLIB_DIR} ] || mkdir -p ${BLIB_DIR}

PHPRC="${PROJECT_DIR}/etc/php.ini"

if [ -n "${CYGWIN}" ] ; then
    PHPRC="`cygpath -w -l -a -- "${PHPRC}"`"
fi

PHP_EXE="`which php-cli 2>/dev/null`"
if [ ! -x "${PHP_EXE}" ]; then
    PHP_EXE="`which php 2>/dev/null`"
fi
if [ ! -x "${PHP_EXE}" ]; then
    echo "Sorry but can't find php."; exit 1
fi

cd ${LIB_DIR}

for lib in `find . -iname "*.php" -type f`
do
    echo "Processing ${lib}"
    lib_dir=$(dirname ${BLIB_DIR}/${lib})
    [ -d ${lib_dir} ] || mkdir -p ${lib_dir}
    ${PHP_EXE} -w "${lib}" > "${BLIB_DIR}/${lib}"
done

cd - > /dev/null
